RewriteEngine On

# ------------------
# Redirection www → non-www
# ------------------
RewriteCond %{HTTP_HOST} ^www\.ripair\.shop [NC]
RewriteRule ^(.*)$ https://ripair.shop/$1 [L,R=301]

# ------------------
# Redirection HTTP → HTTPS
# ------------------
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ------------------

# Interdire l’accès direct au fichier .env
<FilesMatch "^\.env">
  Require all denied
</FilesMatch>

# Interdire l’accès à config.php
<FilesMatch "config\.php$">
  Require all denied
</FilesMatch>

# ------------------
# Cache-Control et Expires pour assets
# ------------------
<IfModule mod_expires.c>
  ExpiresActive On

  # Fonts : 1 an + immutable
  <FilesMatch "\.(woff|woff2|ttf|otf)$">
    ExpiresDefault "access plus 1 year"
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  # CSS et JS : 30 jours
  <FilesMatch "\.(css|js)$">
    ExpiresDefault "access plus 30 days"
    Header set Cache-Control "public, max-age=2592000"
  </FilesMatch>

  # Images : 30 jours
  <FilesMatch "\.(jpg|jpeg|png|webp|gif|svg)$">
    ExpiresDefault "access plus 30 days"
    Header set Cache-Control "public, max-age=2592000"
  </FilesMatch>
</IfModule>
